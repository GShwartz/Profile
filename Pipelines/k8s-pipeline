trigger:
- k8s

pool: Gil WebApp

steps:
- task: printAllVariables@1
  displayName: 'Print all variables'

- task: Bash@3
  displayName: 'Clear Containers and Images'
  inputs:
    targetType: 'inline'
    script: 'docker stop $(docker ps -aq) && docker rm $(docker ps -aq) && docker rmi $(docker images -q)'

- task: Bash@3
  displayName: 'Build Docker Image'
  inputs:
    targetType: 'inline'
    script: 'docker build -t gil .'

- task: Bash@3
  displayName: 'Run Docker Image'
  inputs:
    targetType: 'inline'
    script: 'docker run -d -p 8080:80 gil'

- task: Bash@3
  displayName: 'Wait for Testing'
  inputs:
    targetType: 'inline'
    script: 'echo "Waiting for 10 minutes to test the container"; sleep 600'